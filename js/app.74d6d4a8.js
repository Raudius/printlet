(function(){"use strict";var e={397:function(e,t,o){var n=o(821);function i(e,t,o,i,a,l){const r=(0,n.resolveComponent)("PrintletForm");return(0,n.openBlock)(),(0,n.createBlock)(r)}const a=e=>((0,n.pushScopeId)("data-v-14a98ac4"),e=e(),(0,n.popScopeId)(),e),l={class:"form"},r=a((()=>(0,n.createElementVNode)("h1",null,"Printlet",-1))),s=a((()=>(0,n.createElementVNode)("p",null,"Create printable booklets from your browser!",-1))),u=a((()=>(0,n.createElementVNode)("p",null,[(0,n.createTextVNode)("For questions and feature requests open an issue on "),(0,n.createElementVNode)("a",{href:"http://github.com/Raudius/printlet/issues"},"Github")],-1))),c=(0,n.createTextVNode)(" 1. Load PDF "),d=(0,n.createTextVNode)(" info "),p=a((()=>(0,n.createElementVNode)("h2",null,"2. Settings",-1))),m=a((()=>(0,n.createElementVNode)("h2",null,"3. Download booklet",-1))),f=(0,n.createTextVNode)(" Download ");function h(e,t,o,i,a,h){const g=(0,n.resolveComponent)("ui-icon"),_=(0,n.resolveComponent)("InputPdf"),b=(0,n.resolveComponent)("InputOptions"),v=(0,n.resolveComponent)("ui-button"),N=(0,n.resolveDirective)("tooltip");return(0,n.openBlock)(),(0,n.createElementBlock)("div",l,[r,s,u,(0,n.createElementVNode)("h2",null,[c,(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)(g,{"aria-describedby":"tooltip-load-pdf",size:18},{default:(0,n.withCtx)((()=>[d])),_:1})),[[N,"No files are uploaded, all processing is done locally inside the browser!"]])]),(0,n.createVNode)(_,{onUpdated:h.setPdfFile},null,8,["onUpdated"]),p,(0,n.createVNode)(b,{onUpdated:h.setBookletOptions},null,8,["onUpdated"]),m,(0,n.createVNode)(v,{raised:"",icon:"download_for_offline",onClick:h.submitForm},{default:(0,n.withCtx)((()=>[f])),_:1},8,["onClick"])])}const g=e=>((0,n.pushScopeId)("data-v-06351356"),e=e(),(0,n.popScopeId)(),e),_={class:"upload_container"},b={key:0,class:"upload_container_file_name"},v=g((()=>(0,n.createElementVNode)("br",null,null,-1))),N={key:0},V=(0,n.createTextVNode)(" Looks like this document contains both landscape and portrait pages. "),k=g((()=>(0,n.createElementVNode)("label",{class:"min_width_m"},"Select orientation:",-1)));function w(e,t,o,i,a,l){const r=(0,n.resolveComponent)("ui-file"),s=(0,n.resolveComponent)("ui-alert"),u=(0,n.resolveComponent)("ui-segmented-buttons"),c=(0,n.resolveComponent)("ui-form-field");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createElementVNode)("div",_,[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(r,{accept:"application/pdf",onChange:l.loadFile,text:"Select file..."},null,8,["onChange"]),l.fileName?((0,n.openBlock)(),(0,n.createElementBlock)("div",b,(0,n.toDisplayString)(l.fileName),1)):(0,n.createCommentVNode)("",!0)])]),v,l.isPdfOrientationAmbiguous?((0,n.openBlock)(),(0,n.createElementBlock)("div",N,[(0,n.createVNode)(s,{class:"no_top_margin",state:"warning"},{default:(0,n.withCtx)((()=>[V])),_:1}),(0,n.createVNode)(c,null,{default:(0,n.withCtx)((()=>[k,(0,n.createElementVNode)("span",null,[(0,n.createVNode)(u,{modelValue:a.pdf_file.pdf_orientation_manual,"onUpdate:modelValue":t[0]||(t[0]=e=>a.pdf_file.pdf_orientation_manual=e),onChange:l.updateForm,items:[{icon:"crop_portrait",text:"Portrait"},{icon:"crop_landscape",text:"Landscape"}],"single-select":""},null,8,["modelValue","onChange"])])])),_:1})])):(0,n.createCommentVNode)("",!0)],64)}var P=o(495),C=o(733),x=o(482);class y{constructor(e=0,t=0){this.x=e,this.y=t}transpose(){[this.x,this.y]=[this.y,this.x]}}function O(e,t){return Promise.all(t.getPageProviders(e).map((async o=>{const n=await E(e,t,o);return await n.save()})))}async function F(e,t){let o=await P.PDFDocument.create();const n=t.getPageProviders(e);for(const i in n){const a=n[i],l=o.getPageCount()%2;for(let e=0;e<l;e++)o.addPage();await E(e,t,a,o)}return o.save()}async function E(e,t,o,n=null){const i=P.PageSizes[t.page_size],a=T(e,t,o);null===n&&(n=await P.PDFDocument.create());const l=n.getPageCount();for(let g=0;g<a;g++){const e=n.addPage(i);t.rotate_even_pages&&g%2===1&&e.setRotation((0,P.degrees)(180))}const r=t.text_read_direction===L.R2L,s=S(e,t),u=!s&&!r,c=!s||!r,d=A(e,t),p=new y,m=new y(i[0]/d.x,i[1]/d.y),f=await P.PDFDocument.load(await e.document.save());let h=o.reset();while(h>=0){const e=l+D(h-o.start,a,d),t=n.getPage(e),i=f.getPages()[h],r=await n.embedPage(i,null,s?[0,-1,1,0,0,i.getWidth()]:null);s&&m.transpose();const g=Math.min(m.x/i.getWidth(),m.y/i.getHeight());s&&m.transpose(),t.drawPage(r,{x:(u?p.x:d.x-p.x-1)*m.x,y:(c?p.y:d.y-p.y-1)*m.y,xScale:g,yScale:g}),B(p,d),h=o.next()}return n}function B(e,t){++e.x>=t.x&&(e.x=0,++e.y>=t.y&&(e.y=0))}function D(e,t,o){const n=Math.floor(e/(o.x*o.y/2));return Math.abs(n%t-(t-1)*Math.floor(n/t))}function S(e,t){return t.getFoldOrientation(e)===U.VERTICAL}function T(e,t,o){const n=o.range(),i=2*I(e,t);return 2*Math.ceil(n/i)}function I(e,t){const o=A(e,t);return o.x*o.y}function A(e,t){return e.getOrientation()===t.getFoldOrientation(e)?new y(1,2):new y(2,2)}var R=o(955);const z={expires:5e3,sameSite:"strict"},U={UNKNOWN:-1,PORTRAIT:0,LANDSCAPE:1,VERTICAL:0,HORIZONTAL:1},Z={PDF:0,ZIP:1},L={L2R:0,R2L:1};class j{constructor(e,t){(0,x.Z)(this,"orientation_manual",U.UNKNOWN),this.file_name=e,this.document=t,this.orientation=q(t)}getOrientation(){return this.orientation!==U.UNKNOWN?this.orientation:this.orientation_manual}getBaseName(){return this.file_name.replaceAll(".pdf","")}}function M(){const e=new W;for(const t in e){const o=e[t]?.constructor,n=R.Z.get(t),i=o?o(n):null;n&&null!==i&&(e[t]=i,console.log(t+" -> "+i))}return e}class W{constructor(){this.text_read_direction=L.L2R,this.pages_per_page=1,this.rotate_even_pages=!1,this.page_size="A4",this.multiple_booklets=!1,this.booklet_size=6,this.output_format=Z.ZIP}save(){for(const e in this)R.Z.set(e,this[e],z)}getOutputFormat(){return this.multiple_booklets?this.output_format:Z.PDF}getFoldOrientation(e){const t=e.getOrientation(),o=t===U.PORTRAIT?U.LANDSCAPE:U.PORTRAIT;return this.pages_per_page%2===0?o:t}getPageProviders(e){const t=[],o=e.document.getPageCount(),n=this.multiple_booklets?this.booklet_size:o,i=I(e,this)*n*2;let a=0;while(a<o){const e=new K;e.start=a,a+=i,e.end=Math.min(a,o),t.push(e)}return t}}class K{constructor(e,t){(0,x.Z)(this,"current",0),(0,x.Z)(this,"start",0),(0,x.Z)(this,"end",0),(0,x.Z)(this,"step",1),this.start=e,this.current=e,this.end=t}range(){return this.end-this.start}next(){return this.current+=this.step,this.end-this.current>0?this.current:-1}reset(){return this.current=this.start,this.current}}function q(e){const t=e.getPages();let o=H(t[0]);for(let n=0;n<t.length;n++){const e=t[n],i=H(e);if(o!==i)return U.UNKNOWN}return o}function H(e){const{width:t,height:o}=e.getSize(),n=e.getRotation().angle/90%2!==0,i=t>o;return i&&!n||!i&&n?U.LANDSCAPE:U.PORTRAIT}async function $(e){return await Y(e).then((async t=>{const o=await P.PDFDocument.load(t);return new j(e.name,o)}))}async function G(e,t){let o=new C;return t.forEach(((t,n)=>{const i=e+"_"+(n+1)+".pdf";o.file(i,t)})),o.generateAsync({type:"uint8array"})}const Y=e=>new Promise(((t,o)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=e=>o(e)}));var J={name:"InputPdf",data(){return{pdf_file:{}}},emits:{updated:null},methods:{async loadFile(e){const t=e[0].sourceFile;this.pdf_file=await $(t),this.updateForm()},updateForm(){this.$emit("updated",this.pdf_file)}},computed:{fileName(){return this.pdf_file?.file_name},isPdfOrientationAmbiguous(){return null!==this.pdf_file?.document&&this.pdf_file?.orientation===U.UNKNOWN}}},Q=o(744);const X=(0,Q.Z)(J,[["render",w],["__scopeId","data-v-06351356"]]);var ee=X;const te=(0,n.createTextVNode)(" Booklet type: "),oe=(0,n.createTextVNode)("info"),ne=(0,n.createElementVNode)("div",null,"Advanced options",-1),ie=(0,n.createElementVNode)("label",null,"Text read direction:",-1),ae=(0,n.createElementVNode)("label",null,"Print page size:",-1),le=(0,n.createTextVNode)(" Create multiple booklets: "),re=(0,n.createTextVNode)("info"),se=(0,n.createElementVNode)("label",null,"Sheets per booklet:",-1),ue=(0,n.createElementVNode)("label",null,"Output format:",-1),ce=(0,n.createTextVNode)(" Rotate alternate pages 180Â°: "),de=(0,n.createTextVNode)("info");function pe(e,t,o,i,a,l){const r=(0,n.resolveComponent)("ui-icon"),s=(0,n.resolveComponent)("ui-segmented-buttons"),u=(0,n.resolveComponent)("ui-form-field"),c=(0,n.resolveComponent)("ui-form"),d=(0,n.resolveComponent)("ui-select"),p=(0,n.resolveComponent)("ui-switch"),m=(0,n.resolveComponent)("ui-textfield"),f=(0,n.resolveComponent)("ui-collapse"),h=(0,n.resolveDirective)("tooltip");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)(c,{nowrap:"","item-margin-bottom":"16"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(u,null,{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("label",null,[te,(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)(r,{size:18,"aria-describedby":"tooltip_booklet_type"},{default:(0,n.withCtx)((()=>[oe])),_:1})),[[h,"Fit 2 input pages per booklet page by selecting the 'double page' option."]])]),(0,n.createElementVNode)("span",null,[(0,n.createVNode)(s,{"model-value":this.options.pages_per_page-1,"onUpdate:modelValue":l.updatePagesPerPage,"single-select":"",items:[{text:"Single page",icon:"rectangle"},{text:"Double page",icon:"view_agenda"}]},null,8,["model-value","onUpdate:modelValue"])])])),_:1})])),_:1}),(0,n.createVNode)(f,{"with-icon":"",ripple:""},{toggle:(0,n.withCtx)((()=>[ne])),default:(0,n.withCtx)((()=>[(0,n.createVNode)(c,{nowrap:"","item-margin-bottom":"16"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(u,null,{default:(0,n.withCtx)((()=>[ie,(0,n.createElementVNode)("span",null,[(0,n.createVNode)(s,{modelValue:a.options.text_read_direction,"onUpdate:modelValue":t[0]||(t[0]=e=>a.options.text_read_direction=e),onChange:l.updated,items:[{icon:"east",text:"Left to right"},{icon:"west",text:"Right to left"}],"single-select":""},null,8,["modelValue","onChange"])])])),_:1}),(0,n.createVNode)(u,null,{default:(0,n.withCtx)((()=>[ae,(0,n.createElementVNode)("span",null,[(0,n.createVNode)(d,{modelValue:a.options.page_size,"onUpdate:modelValue":t[1]||(t[1]=e=>a.options.page_size=e),options:a.PageSizeOptions,onChange:l.updated},null,8,["modelValue","options","onChange"])])])),_:1}),(0,n.createVNode)(u,null,{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("label",null,[le,(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)(r,{size:18,"aria-describedby":"tooltip_multiple_booklets"},{default:(0,n.withCtx)((()=>[re])),_:1})),[[h,"For large PDF files it is often easier to create multiple smaller booklets."]])]),(0,n.createVNode)(p,{modelValue:a.options.multiple_booklets,"onUpdate:modelValue":t[2]||(t[2]=e=>a.options.multiple_booklets=e),onChange:l.updated,"input-id":"input_booklet_size","true-value":4,"false-value":0},null,8,["modelValue","onChange"])])),_:1}),a.options.multiple_booklets?((0,n.openBlock)(),(0,n.createBlock)(u,{key:0},{default:(0,n.withCtx)((()=>[se,(0,n.createVNode)(m,{"input-type":"number",modelValue:a.options.booklet_size,"onUpdate:modelValue":t[3]||(t[3]=e=>a.options.booklet_size=e)},null,8,["modelValue"])])),_:1})):(0,n.createCommentVNode)("",!0),a.options.multiple_booklets?((0,n.openBlock)(),(0,n.createBlock)(u,{key:1},{default:(0,n.withCtx)((()=>[ue,(0,n.createVNode)(d,{modelValue:this.options.output_format,"onUpdate:modelValue":t[4]||(t[4]=e=>this.options.output_format=e),onChange:l.updated,options:a.OutputFormatOptions},null,8,["modelValue","onChange","options"])])),_:1})):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(u,null,{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("label",null,[ce,(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)(r,{size:18,"aria-describedby":"tooltip_rotate_pages"},{default:(0,n.withCtx)((()=>[de])),_:1})),[[h,"Some printers may flip the back of a double-sided print. You can correct this behaviour by ticking this option."]])]),(0,n.createVNode)(p,{modelValue:a.options.rotate_even_pages,"onUpdate:modelValue":t[5]||(t[5]=e=>a.options.rotate_even_pages=e),onChange:l.updated},null,8,["modelValue","onChange"])])),_:1})])),_:1})])),_:1})],64)}var me=o(25);const fe=Object.keys(P.PageSizes).map((e=>({label:e,value:e}))),he=[{label:"Single PDF file",value:Z.PDF},{label:"Zipped PDF files",value:Z.ZIP}];var ge={name:"InputOptions",data(){return{PageSizeOptions:fe,OutputFormatOptions:he,options:M(),multiple_booklets:!1}},emits:{updated:null},methods:{updated(){this.$emit("updated",this.options)},updatePagesPerPage(e){this.options.pages_per_page=e+1,this.updated()}},mounted(){this.updated()},directives:{tooltip:me.u2}};const _e=(0,Q.Z)(ge,[["render",pe]]);var be=_e,ve=o(729),Ne=o.n(ve),Ve={name:"PrintletForm",components:{InputOptions:be,InputPdf:ee},data(){return{booklet_options:null,pdf_file:null}},methods:{setBookletOptions(e){this.booklet_options=e},setPdfFile(e){this.pdf_file=e},async submitForm(){if(!this.pdf_file||this.pdf_file.orientation===U.UNKNOWN)return void alert("PDF file is missing!");const e=this.pdf_file.getBaseName()+"_booklet";if(this.booklet_options.getOutputFormat()===Z.ZIP){const t=await O(this.pdf_file,this.booklet_options),o=await G(this.pdf_file.getBaseName(),t);Ne()(o,e+".zip","application/zip")}else{const t=await F(this.pdf_file,this.booklet_options);Ne()(t,e+".pdf","application/pdf")}this.booklet_options.save()}},directives:{tooltip:me.u2}};const ke=(0,Q.Z)(Ve,[["render",h],["__scopeId","data-v-14a98ac4"]]);var we=ke,Pe={name:"App",components:{PrintletForm:we}};const Ce=(0,Q.Z)(Pe,[["render",i]]);var xe=Ce,ye=o(275),Oe=o.n(ye);const Fe=(0,n.createApp)(xe);Fe.use(me.ZP),Fe.use(Oe()),Fe.mount("#app")}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports}o.m=e,function(){var e=[];o.O=function(t,n,i,a){if(!n){var l=1/0;for(c=0;c<e.length;c++){n=e[c][0],i=e[c][1],a=e[c][2];for(var r=!0,s=0;s<n.length;s++)(!1&a||l>=a)&&Object.keys(o.O).every((function(e){return o.O[e](n[s])}))?n.splice(s--,1):(r=!1,a<l&&(l=a));if(r){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,i,a]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,a,l=n[0],r=n[1],s=n[2],u=0;if(l.some((function(t){return 0!==e[t]}))){for(i in r)o.o(r,i)&&(o.m[i]=r[i]);if(s)var c=s(o)}for(t&&t(n);u<l.length;u++)a=l[u],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},n=self["webpackChunkprintlet"]=self["webpackChunkprintlet"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(397)}));n=o.O(n)})();
//# sourceMappingURL=app.74d6d4a8.js.map